---
title: Laravel 请求生命周期
---

# 请求生命周期

[[toc]]

## 简介

在“现实世界”中使用任何工具时，如果您了解该工具的工作原理，您会感觉更加自信。应用程序开发也不例外。当您了解您的开发工具的功能时，使用它们时会感到更加舒适和自信。

本文档的目标是给您一个关于 Laravel 框架如何工作的良好、高层次的概述。通过更好地了解整个框架，一切都会感觉不那么“神奇”，在构建应用程序时您会更加自信。如果您不立即理解所有术语，不要灰心！只需尝试基本了解正在发生的事情，随着您探索文档的其他部分，您的知识将会增长。

## 生命周期概览

### 第一步

所有请求进入 Laravel 应用程序的入口点是 `public/index.php` 文件。您的 Web 服务器（Apache / Nginx）配置将所有请求定向到这个文件。`index.php` 文件中没有太多代码。相反，它是加载框架其余部分的起点。

`index.php` 文件加载 Composer 生成的自动加载器定义，然后从 `bootstrap/app.php` 获取 Laravel 应用程序的实例。Laravel 自己采取的第一个动作是创建应用程序 / [服务容器](/docs/11/architecture-concepts/container)的实例。

### HTTP / 控制台内核

接下来，根据请求进入应用程序的类型，使用应用程序实例的 `handleRequest` 或 `handleCommand` 方法，将传入的请求发送到 HTTP 内核或控制台内核。这两个内核作为所有请求流经的中心位置。现在，让我们只关注 HTTP 内核，它是 `Illuminate\Foundation\Http\Kernel` 的实例。

HTTP 内核定义了一个 `bootstrappers` 数组，这些 `bootstrappers` 将在请求执行之前运行。这些引导程序配置错误处理、配置日志记录、[检测应用环境](/docs/11/getting-started/configuration#environment-configuration)，以及执行请求实际处理之前需要完成的其他任务。通常，这些类处理您不需要担心的内部 Laravel 配置。

HTTP 内核还负责将请求通过应用程序的中间件堆栈传递。这些中间件处理读写 [HTTP 会话](/docs/11/basics/session)、确定应用程序是否处于维护模式、[验证 CSRF 令牌](/docs/11/basics/csrf) 等。我们很快会讨论这些。

HTTP 内核的 `handle` 方法的方法签名非常简单：它接收一个 `Request` 并返回一个 `Response`。将内核视为代表整个应用程序的大黑盒。向它提供 HTTP 请求，它将返回 HTTP 响应。

### 服务提供者

内核引导过程中最重要的动作之一是加载应用程序的[服务提供者](/docs/11/architecture-concepts/providers)。服务提供者负责引导框架的各种组件，如数据库、队列、验证和路由组件。

Laravel 将遍历这个提供者列表并实例化它们。在实例化提供者之后，将调用所有提供者的 `register` 方法。然后，一旦所有提供者都已注册，将在每个提供者上调用 `boot` 方法。这样做是为了服务提供者可以依赖于在其 `boot` 方法执行时每个容器绑定都已注册并可用。

几乎每个 Laravel 提供的主要功能都是通过服务提供者引导和配置的。由于它们引导和配置了框架提供的如此多的功能，服务提供者是整个 Laravel 引导过程中最重要的部分。

虽然框架内部使用了数十个服务提供者，但您也可以创建自己的服务提供者。您可以在 `bootstrap/providers.php` 文件中找到您的应用程序正在使用的用户定义或第三方服务提供者的列表。

### 路由

一旦应用程序被引导并且所有服务提供者都已注册，`Request` 将被交给路由器进行分派。路由器将请求分派给路由或控制器，以及运行任何特定于路由的中间件。

中间件为过滤或检查进入应用程序的 HTTP 请求提供了一种便利机制。例如，Laravel 包括一个中间件，用于验证应用程序用户是否已认证。如果用户未认证，中间件将重定向用户到登录页面。然而，如果用户已认证，中间件将允许请求进一步进入应用程序。一些中间件被分配给应用程序中的所有路由，如 `PreventRequestsDuringMaintenance`，而一些只分配给特定路由或路由组。您可以通过阅读完整的[中间件文档](/docs/11/basics/middleware)来了解更多关于中间件的信息。

如果请求通过了分配给匹配路由的所有中间件，路由或控制器方法将被执行，并且路由或控制器方法返回的响应将通过路由的中间件链返回。

### 结束

一旦路由或控制器方法返回了响应，响应将通过路由的中间件链回传，给应用程序一个机会修改或检查传出的响应。

最后，一旦响应通过中间件回传，HTTP 内核的 `handle` 方法将响应对象返回给应用程序实例的 `handleRequest` 方法，此方法调用返回的响应的 `send` 方法。`send` 方法将响应内容发送给用户的 Web 浏览器。我们现在已经完成了整个 Laravel 请求生命周期的旅程！

## 聚焦服务提供者

服务提供者真正是引导 Laravel 应用程序的关键。创建应用程序实例，注册服务提供者，请求交给引导的应用程序。就这么简单！

通过服务提供者了解和引导 Laravel 应用程序的构建过程非常有价值。您的应用程序的用户定义服务提供者存储在 `app/Providers` 目录中。

默认情况下，`AppServiceProvider` 相当空。这个提供者是添加您自己的应用程序引导和服务容器绑定的好地方。对于大型应用程序，您可能希望创建多个服务提供者，每个提供者都有更精细的引导，专门用于您的应用程序使用的特定服务。
